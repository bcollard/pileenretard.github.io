<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Computer Scientist</title>
	<link rel="stylesheet" href="">

	<meta charset="utf-8">
	<style>

	.link {
	  stroke: #000;
	  stroke-width: 1.5px;
	}

	.node circle {
	  cursor: move;
	}

	.node.fixed {
	  fill: #f00;
	}

	.node text {
	    font: bold 12px sans-serif;
	    fill: darkred;
	    text-shadow: 0 1px 0 #fff;
	}

	</style>
</head>
<body>
	<div id="svgContainer"></div>
	<div id="test"></div>
	
	<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
	<script src="d3.v3.min.js" charset="utf-8"></script>
	<script>
		
		var width = 1800,
		    height = 900;

	    //Set up the colour scale
		var color = d3.scale.category20c();

		var force = d3.layout.force()
		    .size([width, height])
		    .charge(-200)
		    .linkDistance(90)
		    .gravity(0.1)
		    .on("tick", tick);

		var drag = force.drag()
		    .on("dragstart", dragstart);

		var svg = d3.select("body #svgContainer").append("svg")
		    .attr("width", width)
		    .attr("height", height);

		var link = svg.selectAll(".link"),
		    node = svg.selectAll(".node");

		d3.json("data.json", function(error, graph) {
			var edges = [];
		    graph.links.forEach(function(e) { 
			    var sourceNode = graph.nodes.filter(function(n) { return n.name === e.source; })[0],
			    targetNode = graph.nodes.filter(function(n) { return n.name === e.target; })[0];
			    edges.push({source: sourceNode, target: targetNode, value: e.value});
		    });

		  force.nodes(graph.nodes)
		      .links(edges)
		      .start();

		  link = link.data(edges)
		    .enter().append("line")
		      .attr("class", "link");

		  node = node.data(graph.nodes)
		    .enter().append("g")
		    .attr("class", "node")
		    .call(drag);

		    node.append("circle")
		      .attr("r", 12)
		      .style("fill", function (d) {
				    return color(d.group);
				})
		      .on("click", dblclick);

		      node.append("text")
		      .attr("dx", 10)
		      .attr("dy", ".35em")
		      .text(function(d) { return d.label });

		});

		function tick() {
		  link.attr("x1", function(d) { return d.source.x; })
		      .attr("y1", function(d) { return d.source.y; })
		      .attr("x2", function(d) { return d.target.x; })
		      .attr("y2", function(d) { return d.target.y; });

		  node.attr("cx", function(d) { return d.x = Math.max(15, Math.min(width - 15, d.x)); })
    			.attr("cy", function(d) { return d.y = Math.max(15, Math.min(height - 15, d.y)); });

		   d3.selectAll("circle").attr("cx", function (d) {return d.x; })
		        .attr("cy", function (d) { return d.y; });

		    d3.selectAll("text").attr("x", function (d) {return d.x; })
		        .attr("y", function (d) { return d.y; });
		}

		function dblclick(d) {
		  d3.select(this).classed("fixed", d.fixed = false);
		}

		function dragstart(d) {
		  d3.select(this).classed("fixed", d.fixed = true);
		}

		/*
		var body = $("body > #test");
		var pA = [];
		for (var bapt = 0; bapt < 20 ; bapt++) {
			var p = $('<p/>');
  			p.html("jquery elements #" + bapt);
  			p.css("color", color(bapt));
  			pA.push(p);
		}
		body.append(pA);
		*/
	</script>

</body>
</html>